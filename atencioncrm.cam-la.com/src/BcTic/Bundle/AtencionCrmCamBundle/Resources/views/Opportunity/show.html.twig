
{% extends '::base.html.twig' %}

{% block body %}

{% set interes_comercial = 0 %}

{% set interes_comercial_factor_1 = 0 %}

{% if entity.tamanno_backlog_c == 'GRANDE' %}
{% set interes_comercial_factor_1 = 100 %}
{% endif %}

{% if entity.tamanno_backlog_c == 'MEDIANO' %}
{% set interes_comercial_factor_1 = 75 %}
{% endif %}

{% if entity.tamanno_backlog_c == 'PEQUENNO' %}
{% set interes_comercial_factor_1 = 50 %}
{% endif %}

{% set interes_comercial_ponderacion_factor_1 = 0.30 %}

{% set interes_comercial_factor_2 = 0 %}

{% if entity.margen_esperado_c > 9.9 %}
  {% set interes_comercial_factor_2 = 30 %}
{% endif %}

{% if entity.margen_esperado_c > 14.9 %}
  {% set interes_comercial_factor_2 = 60 %}
{% endif %}

{% if entity.margen_esperado_c > 19.9 %}
  {% set interes_comercial_factor_2 = 80 %}
{% endif %}

{% if entity.margen_esperado_c > 24.5 %}
  {% set interes_comercial_factor_2 = 100 %}
{% endif %}

{% set interes_comercial_ponderacion_factor_2 = 0.25 %}

{% set interes_comercial_factor_3 = 0 %}

{% if entity.tamanno_plazo_c == 'GRANDE' %}
{% set interes_comercial_factor_3 = 100 %}
{% endif %}

{% if entity.tamanno_plazo_c == 'MEDIANO' %}
{% set interes_comercial_factor_3 = 75 %}
{% endif %}

{% if entity.tamanno_plazo_c == 'PEQUENNO' %}
{% set interes_comercial_factor_3 = 50 %}
{% endif %}

{% set interes_comercial_ponderacion_factor_3 = 0.25 %}

{% set interes_comercial_factor_4 = 0 %}

{% if entity.riesgo_financiero_cliente_c == 10 %}
{% set interes_comercial_factor_4 = 20 %}
{% endif %}

{% if entity.riesgo_financiero_cliente_c == 5 %}
{% set interes_comercial_factor_4 = 75 %}
{% endif %}

{% if entity.riesgo_financiero_cliente_c == 1 %}
{% set interes_comercial_factor_4 = 100 %}
{% endif %}

{% set interes_comercial_ponderacion_factor_4 = 0.20 %}

{% set interes_comercial = interes_comercial_factor_1 * interes_comercial_ponderacion_factor_1 + interes_comercial_factor_2 * interes_comercial_ponderacion_factor_2 + interes_comercial_factor_3 * interes_comercial_ponderacion_factor_3 + interes_comercial_factor_4 * interes_comercial_ponderacion_factor_4 %}

{% set class_interes_comercial = "alert alert-danger" %}

{% if interes_comercial > 49 %}
{% set class_interes_comercial = "alert alert-warning" %}
{% endif %}

{% if interes_comercial > 74 %}
  {% set class_interes_comercial = "alert alert-success" %}
{% endif %}

{% set oportunidad_de_ganar = 0 %}

{% set oportunidad_de_ganar_factor_1 = 0 %}

{% if entity.competividad_en_precio_c == 10 %}
{% set oportunidad_de_ganar_factor_1 = 100 %}
{% endif %}

{% if entity.competividad_en_precio_c == 5 %}
{% set oportunidad_de_ganar_factor_1 = 70 %}
{% endif %}

{% if entity.competividad_en_precio_c == 1 %}
{% set oportunidad_de_ganar_factor_1 = 30 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_1 = 0.09 %}

{% set oportunidad_de_ganar_factor_2 = 0 %}

{% if entity.competitividad_tecnica_c == 10 %}
{% set oportunidad_de_ganar_factor_2 = 100 %}
{% endif %}

{% if entity.competitividad_tecnica_c == 5 %}
{% set oportunidad_de_ganar_factor_2 = 70 %}
{% endif %}

{% if entity.competitividad_tecnica_c == 1 %}
{% set oportunidad_de_ganar_factor_2 = 30 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_2 = 0.09 %}

{% set oportunidad_de_ganar_factor_3 = 0 %}

{% if entity.fidelizacion_comercial_c == 10 %}
{% set oportunidad_de_ganar_factor_3 = 100 %}
{% endif %}

{% if entity.fidelizacion_comercial_c == 5 %}
{% set oportunidad_de_ganar_factor_3 = 70 %}
{% endif %}

{% if entity.fidelizacion_comercial_c == 1 %}
{% set oportunidad_de_ganar_factor_3 = 30 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_3 = 0.15 %}

{% set oportunidad_de_ganar_factor_4 = 0 %}

{% if entity.fidelizacion_tecnica_c == 10 %}
{% set oportunidad_de_ganar_factor_4 = 100 %}
{% endif %}

{% if entity.fidelizacion_tecnica_c == 5 %}
{% set oportunidad_de_ganar_factor_4 = 70 %}
{% endif %}

{% if entity.fidelizacion_tecnica_c == 1 %}
{% set oportunidad_de_ganar_factor_4 = 30 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_4 = 0.15 %}

{% set oportunidad_de_ganar_factor_5 = 0 %}

{% if entity.fidelizacion_compras_c == 10 %}
{% set oportunidad_de_ganar_factor_5 = 100 %}
{% endif %}

{% if entity.fidelizacion_compras_c == 5 %}
{% set oportunidad_de_ganar_factor_5 = 70 %}
{% endif %}

{% if entity.fidelizacion_compras_c == 1 %}
{% set oportunidad_de_ganar_factor_5 = 30 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_5 = 0.15 %}

{% set oportunidad_de_ganar_factor_6 = 0 %}

{% if entity.tipo_de_invitacion_c == 'DIRECTA' %}
{% set oportunidad_de_ganar_factor_6 = 100 %}
{% endif %}

{% if entity.tipo_de_invitacion_c == 'ICITACION_C_PART_BASES' %}
{% set oportunidad_de_ganar_factor_6 = 75 %}
{% endif %}

{% if entity.tipo_de_invitacion_c == 'LICITACION_S_PART_BASES' %}
{% set oportunidad_de_ganar_factor_6 = 40 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_6 = 0.135 %}

{% set oportunidad_de_ganar_factor_7 = 0 %}

{% if entity.propuesta_de_valor_diferenci_c == 'YES' %}
{% set oportunidad_de_ganar_factor_7 = 100 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_7 = 0.10 %}

{% set oportunidad_de_ganar_factor_8 = 0 %}

{% if entity.cantidad_de_competidores_c == 'NINGUNO' %}
{% set oportunidad_de_ganar_factor_8 = 100 %}
{% endif %}

{% if entity.cantidad_de_competidores_c == 'MENOR_A_4' %}
{% set oportunidad_de_ganar_factor_8 = 75 %}
{% endif %}

{% if entity.cantidad_de_competidores_c == 'ENTRE_4_Y_8' %}
{% set oportunidad_de_ganar_factor_8 = 60 %}
{% endif %}

{% if entity.cantidad_de_competidores_c == 'MAYOR_A_8' %}
{% set oportunidad_de_ganar_factor_8 = 20 %}
{% endif %}

{% set oportunidad_de_ganar_ponderacion_factor_8 = 0.135 %}

{% set oportunidad_de_ganar = oportunidad_de_ganar_factor_1 * oportunidad_de_ganar_ponderacion_factor_1 + oportunidad_de_ganar_factor_2 * oportunidad_de_ganar_ponderacion_factor_2 + oportunidad_de_ganar_factor_3 * oportunidad_de_ganar_ponderacion_factor_3 + oportunidad_de_ganar_factor_4 * oportunidad_de_ganar_ponderacion_factor_4 + oportunidad_de_ganar_factor_5 * oportunidad_de_ganar_ponderacion_factor_5 + oportunidad_de_ganar_factor_6 * oportunidad_de_ganar_ponderacion_factor_6 + oportunidad_de_ganar_factor_7 * oportunidad_de_ganar_ponderacion_factor_7 + oportunidad_de_ganar_factor_8 * oportunidad_de_ganar_ponderacion_factor_8 %}

{% set class_oportunidad_de_ganar = "alert alert-danger" %}

{% if oportunidad_de_ganar > 49 %}
{% set class_oportunidad_de_ganar = "alert alert-warning" %}
{% endif %}

{% if oportunidad_de_ganar > 74 %}
  {% set class_oportunidad_de_ganar = "alert alert-success" %}
{% endif %}

{% set capacidad_empresa = 0 %}

{% set capacidad_empresa_factor_1 = 50 %}

{% if entity.experiencia_con_mandante_c == 'YES' %}
{% set capacidad_empresa_factor_1 = 100 %}
{% endif %}

{% set capacidad_empresa_ponderacion_factor_1 = 0.30 %}

{% set capacidad_empresa_factor_2 = 50 %}

{% if entity.experiencia_con_mandante_c == 'YES' %}
{% set capacidad_empresa_factor_2 = 100 %}
{% endif %}

{% set capacidad_empresa_ponderacion_factor_2 = 0.40 %}

{% set capacidad_empresa_factor_3 = 0 %}

{% if entity.requerimiento_caja_c == 10 %}
{% set capacidad_empresa_factor_3 = 30 %}
{% endif %}

{% if entity.requerimiento_caja_c == 5 %}
{% set capacidad_empresa_factor_3 = 70 %}
{% endif %}

{% if entity.requerimiento_caja_c == 1 %}
{% set capacidad_empresa_factor_3 = 100 %}
{% endif %}

{% set capacidad_empresa_ponderacion_factor_3 = 0.30 %}

{% set capacidad_empresa = capacidad_empresa_factor_1 * capacidad_empresa_ponderacion_factor_1 + capacidad_empresa_factor_2 * capacidad_empresa_ponderacion_factor_2 + capacidad_empresa_factor_3 * capacidad_empresa_ponderacion_factor_3 %}

{% set class_capacidad_empresa = "alert alert-danger" %}

{% if capacidad_empresa > 49 %}
{% set class_capacidad_empresa = "alert alert-warning" %}
{% endif %}

{% if capacidad_empresa > 74 %}
{% set class_capacidad_empresa = "alert alert-success" %}
{% endif %}

<div class="panel panel-default">
  <div class="panel-heading">
    <div class="row">
      <div class="col-md-3">
        <br/>
        <h4 class="text-center">CAM.GPN.PG.01-F01</h4>
      </div>
      <div class="col-md-6">
        <h3 class="text-center">Ficha de selectividad</h3>
        <h4 class="text-center">- Servicios & Proyectos -</h4>
      </div>
      <div class="col-md-3">
        <br/>
        <div class="row">
          <div class="col-md-6">Revisión</div>
          <div class="col-md-6">3.3</div>
        </div>
        <div class="row">
          <div class="col-md-6">Fecha</div>
          <div class="col-md-6">{{ "now" | date('d/m/Y') }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="panel-body">


          <table class="table table-bordered">
            <tr>
              <th colspan="4">
                <h4>Información general</h4>
              </th>
            </tr>
            <tr>
              <th style="width: 20%;">Nombre Oportunidad</th>
              <td>{{ entity.name }}</td>
              <th style="width: 20%;">Responsable Comercial</th>
              <td>{{ entity.assigned_user_name }}</td>
            </tr>
            <tr>
              <th>Código</th>
              <td>{{ entity.codigo_oportunidad_c }}</td>
              <th>Fecha de invitación</th>
              <td>{{ entity.fecha_de_invitacion_c }}</td>
            </tr>
            <tr>
              <th>Cliente</th>
              <td id="description">{{ entity.account_name }}</td>
              <th>Fecha de presentación</th>
              <td>{{ entity.fecha_de_presentacion_c }}</td>
            </tr>
            <tr>
              <th>Contacto</th>
              <td></td>
              <th>Fecha de entrega</th>
              <td>{{ entity.fecha_de_entrega_c }}</td>
            </tr>
            <tr>
              <th>Tipo / Servicio</th>
              <td id="resolution">{{ entity.servicio_c }}</td>
              <th>Fecha de adjudicacion</th>
              <td>{{ entity.date_closed }}</td>
            </tr>
            <tr>
              <th>Unidad de negocio</th>
              <td id="resolution">{{ entity.bu_c }}</td>
              <th>Fecha de inicio ejecución</th>
              <td>{{ entity.fecha_de_inicio_ejecucion_c }}</td>
            </tr>
            <tr>
              <th>Segmento</th>
              <td id="resolution">{{ entity.segmento_c }}</td>
              <th>Tipo de moneda</th>
              <td>{{ entity.currency_name }}</td>
            </tr>
            <tr>
              <td colspan="2"></td>
              <th>Portafolio</th>
              <td>{{ entity.portafolio_cam_c | trans }}</td>
            </tr>
            <tr>
              <th>Descripción</th>
              <td colspan="3">{{ entity.description }}<br/><br/></td>
            </tr>
          </table>

          <table class="table table-bordered">
            <tr>
              <th>
                <h4>Árbol de decisión</h4>
              </th>
              <th colspan="2">
                <h4>Criterio</h4>
              </th>
              <th colspan="2">
                <h4>Resultado</h4>
              </th>
            </tr>
            <tr>
              <th rowspan="8">
                <h3 class="text-center">Interés comercial</h3>
              </th>
              <th style="width: 25%;">Backlog total (M U$)</th>
              <td style="width: 25%;">{{ entity.backlog_total_c }}&nbsp;|&nbsp;{{ entity.tamanno_backlog_c | trans }}</td>
              <th rowspan="4" colspan="2" class="{{-class_interes_comercial-}}" style="text-align: center!important; vertical-align: middle; font-size:60px;">{{-interes_comercial|number_format(0,'.',',')-}}%</th>
            </tr>
            <tr>
              <th>Márgen target</th>
              <td>{{-entity.margen_esperado_c-}}%</td>
            </tr>
            <tr>
              <th>Plazo (Meses)</th>
              <td>{{-entity.plazo_c-}}&nbsp;|&nbsp;{{ entity.tamanno_plazo_c | trans }}</td>
            </tr>
            <tr>
              <th>Riesgo financiamiento cliente</th>
              <td>
                {% set riesgo = 'RIESGO_' ~ entity.riesgo_financiero_cliente_c  %}
                {{-riesgo | trans-}}
              </td>
            </tr>
            <tr>
              <th colspan="4">Comentarios y justificaciones de interés comercial</th>
            </tr>
            <tr>
              <th>Tipo de cliente</th>
              <td>{{-account.account_type | trans -}}</td>
              <th>Tipo compromiso / Propuesta</th>
              <td>{{-entity.tipo_de_compromiso_c-}}</td>
            </tr>
            <tr>
              <th>Monto Esfuerzo Comercial (MUS$)</th>
              <td>{{-entity.monto_esfuerzo_comercial_c-}}</td>
              <th>M. Backlog al 31/12 (MUS$)</th>
              <td>{{-entity.m_backlog_fin_c-}}</td>
            </tr>
            <tr>
              <td colspan="4"><i>{{-entity.comentarios_interes_comercia_c-}}</i><br/><br/></td>
            </tr>

            <tr>
              <th rowspan="13">
                <h3 class="text-center">Oportunidad de ganar</h3>
              </th>
              <th style="width: 25%;">Competitividad en precio</th>
              <td style="width: 25%;">
                {% set competividad = 'competividad_' ~ entity.competividad_en_precio_c %}
                {{-competividad|trans-}}
              </td>
              <th rowspan="8" colspan="2" class="{{-class_oportunidad_de_ganar-}}" style="text-align: center!important; vertical-align: middle; font-size:60px;">{{-oportunidad_de_ganar|number_format(0,'.',',')-}}%</th>
            </tr>
            <tr>
              <th>Competitividad técnica</th>
              <td>
                {% set competividad = 'competividad_' ~ entity.competitividad_tecnica_c %}
                {{-competividad|trans-}}
              </td>
            </tr>
            <tr>
              <th>Fidelización área del cliente comercial</th>
              <td>
                {% set fidelizacion = 'fidelizacion_' ~ entity.fidelizacion_comercial_c %}
                {{-fidelizacion|trans-}}
              </td>
            </tr>
            <tr>
              <th>Fidelización área del cliente técnica</th>
              <td>
                {% set fidelizacion = 'fidelizacion_' ~ entity.fidelizacion_tecnica_c %}
                {{-fidelizacion|trans-}}
              </td>
            </tr>
            <tr>
              <th>Fidelización área del cliente compras</th>
              <td>
                {% set fidelizacion = 'fidelizacion_' ~ entity.fidelizacion_compras_c %}
                {{-fidelizacion|trans-}}
              </td>
            </tr>
            <tr>
              <th>Tipo de invitación</th>
              <td>{{-entity.tipo_de_invitacion_c | trans -}}</td>
            </tr>
            <tr>
              <th>Propuesta de valor diferenciadora</th>
              <td>{{-entity.propuesta_de_valor_diferenci_c|trans-}}</td>
            </tr>
            <tr>
              <th>Cantidad competidores</th>
              <td>{{-entity.cantidad_de_competidores_c|trans-}}</td>
            </tr>
            <tr>
              <th colspan="4">Comentarios y justificaciones de oportunidad de ganar</th>
            </tr>
            <tr>
              <th>Propuesta de valor</th>
              <td>{{-entity.propuesta_de_valor_c-}}</td>
              <th>¿Socio?</th>
              <td>{{-entity.socio_c-}}</td>
            </tr>
            <tr>
              <th>Nombre de competidores</th>
              <td>{{-entity.nombre_competidores_c-}}</td>
              <th>Márgen del mercado</th>
              <td>{{-entity.margen_del_mercado_c-}}%</td>
            </tr>
            <tr>
              <th>Posición proveedor actual</th>
              <td colspan="3">{{-entity.posicion_proveedor_actual_c-}}</td>
            </tr>
            <tr>
              <td colspan="4">{{-entity.comentarios_oportunidad_c-}}<br/><br/></td>
            </tr>

            <tr>
              <th rowspan="5">
                <h3 class="text-center">Capacidad empresa</h3>
              </th>
              <th style="width: 25%;">Experiencia con mandante</th>
              <td style="width: 25%;">{{-entity.experiencia_con_mandante_c | trans }}</td>
              <th rowspan="3" colspan="2" class="{{-class_capacidad_empresa-}}" style="text-align: center!important; vertical-align: middle; font-size:60px;">{{-capacidad_empresa|number_format(0,'.',',')-}}%</th>
            </tr>
            <tr>
              <th>Experiencia con entorno/estándares</th>
              <td>{{-entity.experiencia_con_entorno_c | trans}}</td>
            </tr>
            <tr>
              <th>Requerimientos caja M USD</th>
              <td>{{-entity.tamanno_req_caja_c | trans -}}&nbsp;|&nbsp;
              {% set caja = 'requerimientos_caja_' ~ entity.tamanno_req_caja_c %}{{ caja | trans }}
              </td>
            </tr>
            <tr>
              <th colspan="4">Comentarios y justificaciones de capacidad empresa</th>
            </tr>
            <tr>
              <td colspan="4">{{-entity.comentarios_capacidad_empres_c}}<br/><br/></td>
            </tr>
            <tr>
              <th rowspan="4">
                <h3 class="text-center">Capacidad presupuestal</h3>
              </th>
              <th style="width: 25%;">Experiencia presupuestal</th>
              <td style="width: 25%;">{{-entity.experiencia_presupuestal_c | trans}}</td>
              <th rowspan="4" colspan="2"></th>
            </tr>
            <tr>
              <th>Tiempo para desarrollo</th>
              <td>{{-entity.tiempo_para_desarrollo_c | trans}}</td>
            </tr>
            <tr>
              <th>Documentación bases</th>
              <td>{{-entity.documentacion_bases_c | trans}}</td>
            </tr>
            <tr>
              <th>Documentación anexos (planos)</th>
              <td>{{-entity.documentacion_anexos_c | trans}}</td>
            </tr>

            <tr>
              <th>
                <h3 class="text-center">Recomendación de la herramienta</h3>
              </th>
              <td colspan="2"><br/><br/></td>
              <td colspan="2"></td>
            </tr>
            <tr>
             <th rowspan="3">
                <h3 class="text-center">Decisión comité</h3>
             </th>
             <td colspan="2"><br/><br/></td>
             <td colspan="2"></td>
           </tr>
           <tr>
             <th colspan="4">Estrategia para ganar/Consideraciones</th>
           </tr>
           <tr>
             <td colspan="4">{{-entity.estrategia_para_ganar_c-}}<br/><br/></td>
           </tr>
          </table>

          <table class="table table-bordered">
            <tr>
              <th colspan="2">
                <h4>Responsables</h4>
              </th>
              <th colspan="2">
                <h4>Hitos presupuestales</h4>
              </th>
            </tr>
            <tr>
              <th style="width: 20%;">Líder propuesta</th>
              <td>{{-entity.lider_propuesta_c-}}</td>
              <th style="width: 20%;">Fecha de reunión de lanzamiento</th>
              <td{{-entity.fecha_de_lanzamiento_c-}}></td>
            </tr>
            <tr>
              <th>Experto de apoyo</th>
              <td>{{-entity.experto_de_apoyo_c-}}</td>
              <th>Fecha de reunión de ideas</th>
              <td>{{-entity.fecha_de_reunion_ideas_c-}}</td>
            </tr>
            <tr>
              <th>Fecha de inicio de propuesta</th>
              <td>{{-entity.fecha_inicio_de_propuesta_c-}}</td>
              <th>Fecha de reunión de pre-cierre</th>
              <td>{{-entity.fecha_de_reunion_pre_cierre_c-}}</td>
            </tr>
            <tr>
              <th>Fecha de extensión (si aplica)</th>
              <td>{{-entity.fecha_de_extension_c-}}</td>
              <th>Fecha de reunión de cierre</th>
              <td>{{-entity.fecha_de_reunion_cierre_c-}}</td>
            </tr>
          </table>


  </div>
</div>

{% endblock %}

{% block js %}
{% endblock %}

{% block menu %}
{% endblock %}
