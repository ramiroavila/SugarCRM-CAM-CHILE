SELECT opportunities_cstm.codigo_oportunidad_c as CODIGO, opportunities_cstm.bu_c as BU, opportunities.name as NOMBRE, DATE_FORMAT(opportunities.date_entered,'%d-%m-%Y') as FECHA_CREACION, CASE opportunities_audit.before_value_string WHEN 'Closed Won' THEN 'ADJUDICADO' WHEN 'Closed Lost' THEN 'PERDIDA' ELSE  opportunities_audit.before_value_string END as DESDE_ESTADO, CASE opportunities_audit.after_value_string WHEN 'Closed Won' THEN 'ADJUDICADO' WHEN 'Closed Lost' THEN 'PERDIDA' ELSE opportunities_audit.after_value_string END as HASTA_ESTADO, DATE_FORMAT(opportunities_audit.date_created,'%d-%m-%Y') as FECHA FROM opportunities INNER JOIN opportunities_cstm  ON opportunities.id = opportunities_cstm.id_c INNER JOIN opportunities_audit ON opportunities_audit.parent_id = opportunities.id WHERE opportunities.deleted = 0 AND opportunities_audit.field_name = 'sales_stage' ORDER BY opportunities_cstm.codigo_oportunidad_c ASC, opportunities_audit.date_created ASC;
